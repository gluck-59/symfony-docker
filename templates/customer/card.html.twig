{% extends 'base.html.twig' %}

{% block title %}{{ title }}{% endblock %}


{% block body %}
    <h1>Редактирование «{{ customer.name }}»</h1>
    <dl class="row mb-3">
        {% if is_admin %}
            <dt class="col-sm-2">ID</dt>
            <dd class="col-sm-9">{{ customer.id }}</dd>
        {% endif %}

        <dt class="col-sm-2">Название</dt>
        <dd class="col-sm-9">{{ customer.name }}</dd>

        {% if customer.parent is defined and customer.parent is not null %}
            <dt class="col-sm-2">Родитель</dt>
            <dd class="col-sm-9">{{ customer.parent.name}}</dd>
        {% endif %}

{#        <dt class="col-sm-2">Parent ID</dt>#}
{#        <dd class="col-sm-9">{{ customer.parentId }}</dd>#}

        {% if is_admin %}
        <dt class="col-sm-2">Создатель</dt>
        <dd class="col-sm-9">{{ creator_username ?? '—' }}</dd>
        {% endif %}

        <dt class="col-sm-2">Данные</dt>
        <dd class="col-sm-9"><pre class="mb-0">{{ customer.data }}</pre></dd>
    </dl>

    {% set equipmentList = customer.equipment %}
    <div class="d-flex justify-content-start mt-4 mb-4 gap-3">
        <h3 class="mb-0">Оборудование ({{ equipmentList|length }})</h3>
        <a href="{{ path('equipment_add') }}" class="btn btn-sm btn-success">Добавить оборудование</a>
    </div>
    {% if equipmentList is not empty %}
        <table class="table table-striped table-sm">
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Марка</th>
                    <th>Город</th>
                    <th>Адрес</th>
                    <th>Серийный №</th>
                    <th class="text-end">Действия</th>
                </tr>
            </thead>
            <tbody>
            {% for e in equipmentList %}
                <tr>
                    <td><a href="{{ path('equipment_show', {id: e.id}) }}">{{ e.name }}</a></td>
                    <td>{{ e.mark ?? '—' }}</td>
                    <td>{{ e.city ?? '—' }}</td>
                    <td>{{ e.address ?? '—' }}</td>
                    <td>{{ e.serial ?? '—' }}</td>
                    <td class="text-end">
                        <a href="{{ path('equipment_edit', {id: e.id}) }}" class="btn btn-sm btn-primary"><i class="bi bi-pencil-fill"></i></a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}

    <a class="btn btn-outline-info" href="{{ path('customer_index') }}">Назад</a>
    <a class="btn btn-primary" href="{{ path('customer_edit', {id: customer.id}) }}">Редактировать</a>
    <form method="post" action="{{ path('customer_delete', {id: customer.id}) }}" class="d-inline" onsubmit="return confirm('Удалить клиента #{{ customer.id }}?');">
        <input type="hidden" name="_token" value="{{ csrf_token('delete_customer_' ~ customer.id) }}">
        <button type="submit" class="btn btn-danger">Удалить</button>
    </form>
{% endblock %}
